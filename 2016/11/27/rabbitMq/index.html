<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>RabbitMq | cyrgue</title>
  <meta name="author" content="cyrgue">
  
  <meta name="description" content="PresentationRabbitMQ is an open source messaging broker. It’s often referred to as a message-oriented middleware that implements the Advanced Message ">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="RabbitMq"/>
  <meta property="og:site_name" content="cyrgue"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="cyrgue" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">cyrgue</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-11-27T16:55:00.000Z"><a href="/2016/11/27/rabbitMq/">2016-11-27</a></time>
      
      
  
    <h1 class="title">RabbitMq</h1>
  

    </header>
    <div class="entry">
      
        <h1 id="Presentation"><a href="#Presentation" class="headerlink" title="Presentation"></a>Presentation</h1><p>RabbitMQ is an open source messaging broker. It’s often referred to as a message-oriented middleware that implements the Advanced Message Queuing Protocol (AMQP).</p>
<p>AMQP makes it easy to decouple applications.<br>RabbitMQ provides a common platform for sending and receiving messages, where it guarantee the safety of messages until they are received.<br>RabbitMQ guarantees data delivery, provides non-blocking operations, and sends push notifications.<br>RabbitMQ provides a variety of features, including the tuning of application performance, clustering, flexible routing, federation, and so on.<br>RabbitMQ is one of the most powerful open source message broker software that is widely used in the tech companies such as Mozilla, VMware, Google, AT&amp;T, and so on</p>
<h2 id="Message-brokers"><a href="#Message-brokers" class="headerlink" title="Message brokers"></a>Message brokers</h2><p>A Message Broker is an architectural pattern that can receive messages from multiple destinations, determine the correct destination, and route the message along the correct route,<br>Message Brokers are centralized, in the architectural sense, to control and manage all messages. Therefore, all of the incoming and outgoing messages are sent through Message Brokers, which analyze and deliver the messages to their correct destination.</p>
<h2 id="Message-Queues"><a href="#Message-Queues" class="headerlink" title="Message Queues"></a>Message Queues</h2><p>Message Queues provide concurrent and asynchronous operations to scale applications</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">channel.queueDeclare(queueName,</span> <span class="literal">true</span><span class="string">,</span> <span class="literal">false</span><span class="string">,</span> <span class="literal">false</span><span class="string">,</span> <span class="literal">null</span><span class="string">);</span></span><br></pre></td></tr></table></figure>
<ul>
<li>durable: This specifies whether the queue will survive server restarts. Note that it is required for a queue to be declared as durable if you want persistent messages to survive a server restart.</li>
<li>exclusive: This specifies whether the queue is restricted to only this connection.</li>
<li>autoDelete: This specifies whether the queue will be automatically deleted by the RabbitMQ broker as soon as it is not in use.</li>
</ul>
<p><a href="http://www.rabbitmq.com/releases/rabbitmq-java-client/current-javadoc/com/rabbitmq/client/Channel.html#queueDeclare--" target="_blank" rel="noopener">JavaDoc</a></p>
<p>RabbitMq and EC2<br>we can easily install our RabbitMQ to the AWS EC2 instance and can save images of the RabbitMQ installed operating system</p>
<h2 id="Virtual-hosts"><a href="#Virtual-hosts" class="headerlink" title="Virtual hosts"></a>Virtual hosts</h2><p>Virtual hosts are administrative containers; they allow to configure many logically independent brokers hosts within one single RabbitMQ instance, to let many different independent applications share the same RabbitMQ server. Each virtual host can be configured with its independent set of permissions, exchanges, and queues and will work in a logically separated environment.</p>
<h1 id="Delayed-Message-Exchange"><a href="#Delayed-Message-Exchange" class="headerlink" title="Delayed Message Exchange"></a>Delayed Message Exchange</h1><p>1 - Ajouter le plugin (attention sur docker + ubuntu mettre le fichier 777)</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo docker cp rabbitmq_delayed_message_exchange-<span class="number">0.0</span>.<span class="number">1</span>.ez  <span class="number">88</span><span class="symbol">da72966ec8:</span>/usr/<span class="class"><span class="keyword">lib</span>/<span class="title">rabbitmq</span>/<span class="title">lib</span>/<span class="title">rabbitmq_server</span>-3.6.5/<span class="title">plugins</span>/<span class="title">rabbitmq_delayed_message_exchange</span>-0.0.1.<span class="title">ez</span></span></span><br><span class="line">sudo docker -it <span class="number">88</span>da72966ec8 bash</span><br></pre></td></tr></table></figure>
<p>2 - Declarer un Exchange avec delay</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableRabbit</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">static</span> String queueName = <span class="string">"spring-boot2"</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">static</span> String topicName = <span class="string">"spring-boot-exchange2"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">Queue <span class="title">queue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(queueName, <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">TopicExchange <span class="title">exchange</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        TopicExchange topic = <span class="keyword">new</span> TopicExchange(topicName);</span><br><span class="line">        topic.setDelayed(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> topic;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">Binding <span class="title">binding</span><span class="params">(Queue queue, TopicExchange exchange)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queue).to(exchange).with(queueName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3 - Lors de la reception, renvoyer le message avec un delai</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Receiver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Receiver</span><span class="params">(<span class="keyword">final</span> RabbitTemplate rabbitTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.rabbitTemplate = rabbitTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener</span>(queues = Application.queueName)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receiveMessage</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Received &lt;"</span> + message + <span class="string">"&gt;"</span>);</span><br><span class="line"></span><br><span class="line">        rabbitTemplate.convertAndSend(Application.topicName, Application.queueName, message, <span class="keyword">new</span> MessagePostProcessor() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Message <span class="title">postProcessMessage</span><span class="params">(Message message)</span> <span class="keyword">throws</span> AmqpException </span>&#123;</span><br><span class="line">                message.getMessageProperties().setDelay(<span class="number">15000</span>);</span><br><span class="line">                <span class="keyword">return</span> message;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><ul>
<li><a href="http://docs.spring.io/spring-amqp/reference/html/_reference.html#delayed-message-exchange" target="_blank" rel="noopener">Spring AMQP</a></li>
<li><a href="https://github.com/rabbitmq/rabbitmq-delayed-message-exchange" target="_blank" rel="noopener">RabbitMQ Delayed Message Plugin</a></li>
<li><a href="http://stackoverflow.com/questions/17014584/how-to-create-a-delayed-queue-in-rabbitmq" target="_blank" rel="noopener">How to create a delayed queue in RabbitMQ?</a></li>
</ul>

      
    </div>
    <footer>
      
        
        
        
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    
    
      <a class="addthis_button_tweet"></a>
    
    
      <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    
    
      <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal"></a>
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>

      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">Commentaires</h1>

  
      <div id="fb-root"></div>
<script>
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=123456789012345";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>

<div class="fb-comments" data-href="http://cyrgue.github.io/2016/11/27/rabbitMq/index.html" data-num-posts="5" data-width="840" data-colorscheme="light"></div>
      
  
</section>

</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Rechercher">
    <input type="hidden" name="q" value="site:cyrgue.github.io">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">Categories</h3>
  <ul class="entry">
  
    <li><a href="/categories/java/">java</a><small>3</small></li>
  
    <li><a href="/categories/java/oca-javase8-1/">oca-javase8-1</a><small>2</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/Polymorphisme/">Polymorphisme</a><small>1</small></li>
  
    <li><a href="/tags/angular/">angular</a><small>4</small></li>
  
    <li><a href="/tags/angular2/">angular2</a><small>2</small></li>
  
    <li><a href="/tags/angularjs/">angularjs</a><small>1</small></li>
  
    <li><a href="/tags/angularjs2/">angularjs2</a><small>1</small></li>
  
    <li><a href="/tags/architecture/">architecture</a><small>1</small></li>
  
    <li><a href="/tags/array/">array</a><small>1</small></li>
  
    <li><a href="/tags/aws/">aws</a><small>1</small></li>
  
    <li><a href="/tags/branch/">branch</a><small>1</small></li>
  
    <li><a href="/tags/collections/">collections</a><small>1</small></li>
  
    <li><a href="/tags/componant/">componant</a><small>1</small></li>
  
    <li><a href="/tags/composant/">composant</a><small>1</small></li>
  
    <li><a href="/tags/configuration/">configuration</a><small>2</small></li>
  
    <li><a href="/tags/database/">database</a><small>1</small></li>
  
    <li><a href="/tags/directive/">directive</a><small>1</small></li>
  
    <li><a href="/tags/docker/">docker</a><small>1</small></li>
  
    <li><a href="/tags/ecmascript-2015/">ecmascript 2015</a><small>1</small></li>
  
    <li><a href="/tags/eslint/">eslint</a><small>1</small></li>
  
    <li><a href="/tags/evaluation/">evaluation</a><small>1</small></li>
  
    <li><a href="/tags/exception/">exception</a><small>1</small></li>
  
    <li><a href="/tags/git/">git</a><small>2</small></li>
  
    <li><a href="/tags/iframe/">iframe</a><small>1</small></li>
  
    <li><a href="/tags/java/">java</a><small>8</small></li>
  
    <li><a href="/tags/java8/">java8</a><small>5</small></li>
  
    <li><a href="/tags/javascript/">javascript</a><small>13</small></li>
  
    <li><a href="/tags/jsbin/">jsbin</a><small>1</small></li>
  
    <li><a href="/tags/lambda/">lambda</a><small>1</small></li>
  
    <li><a href="/tags/library/">library</a><small>1</small></li>
  
    <li><a href="/tags/ngrx/">ngrx</a><small>1</small></li>
  
    <li><a href="/tags/node/">node</a><small>1</small></li>
  
    <li><a href="/tags/npm/">npm</a><small>1</small></li>
  
    <li><a href="/tags/observable/">observable</a><small>1</small></li>
  
    <li><a href="/tags/programmation-fonctionnelle/">programmation fonctionnelle</a><small>1</small></li>
  
    <li><a href="/tags/rxjs/">rxjs</a><small>1</small></li>
  
    <li><a href="/tags/select/">select</a><small>1</small></li>
  
    <li><a href="/tags/serverless/">serverless</a><small>2</small></li>
  
    <li><a href="/tags/tests/">tests</a><small>1</small></li>
  
    <li><a href="/tags/thread/">thread</a><small>1</small></li>
  
    <li><a href="/tags/tools/">tools</a><small>1</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
    <div>test</div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2018 cyrgue
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>